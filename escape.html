<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Escape Route Game</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: url('images/world-map.png') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 1rem;
      text-align: center;
      position: relative;
    }

    /* Background overlay for readability */
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.6);
      z-index: -1;
    }
    .container {
      background-color: rgba(255, 255, 255, 0.75);
      padding: 2rem;
      max-width: 1000px;
      margin: auto;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    h1, p {
      text-align: center;
    }
    .message {
      margin: 1rem 0;
      font-size: 1.2rem;
      font-weight: bold;
    }

    svg {
      width: 100%;
      max-width: 1000px;
      height: auto;
    }

    .circle {
      cursor: pointer;
      transition: fill 0.3s;
    }

    .circle:hover {
      fill: orange;
    }

    .circle.active {
      animation: pulse 1.5s infinite;
      stroke: #ff9900;
      stroke-width: 3;
    }

    @keyframes pulse {
      0% { r: 15; opacity: 1; }
      50% { r: 18; opacity: 0.6; }
      100% { r: 15; opacity: 1; }
    }

    .segment {
      stroke: navy;
      stroke-width: 3;
      fill: none;
      stroke-dasharray: 1000;
      stroke-dashoffset: 1000;
      transition: stroke-dashoffset 1s ease-out;
    }

    .story-image {
      max-width: 100%;
      border-radius: 8px;
      margin-top: 10px;
    }
    #storyPanel {
      display: none;
      margin: auto;
      padding: 1rem;
      max-width: 600px;
      background: #fff;
      border-left: 4px solid #2d87f0;
      font-size: 1rem;
      line-height: 1.6;
      text-align: left;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: all 0.3s ease-in-out;
    }

    #resetBtn {
      margin-top: 1rem;
      font-size: 1rem;
      padding: 0.5rem 1.2rem;
      background-color: #2d87f0;
      color: #fff;
      border: none;
      cursor: pointer;
      border-radius: 4px;
      transition: background 0.3s ease;
    }

    #resetBtn:hover {
      background-color: #1c66d6;
    }

    @media (max-width: 600px) {
      svg, #storyPanel {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
  <h1>Escape Route Game</h1>
  <p>Click the locations in the correct order to retrace the journey.</p>
  <div class="message" id="message">Start your journey...</div>

  <svg viewBox="0 0 1000 400" id="escapeMap">
    <!-- Paths and Points (same as before, no change) -->
    <path id="segment1" class="segment" d="M900 100 L820 200" />
    <path id="segment2" class="segment" d="M820 200 L760 240" />
    <path id="segment3" class="segment" d="M760 240 L720 280" />
    <path id="segment4" class="segment" d="M720 280 L500 200" />
    <path id="segment5" class="segment" d="M500 200 L480 140" />
    <path id="segment6" class="segment" d="M480 140 L520 160" />
    <path id="segment7" class="segment" d="M520 160 L480 380" />
    <path id="segment8" class="segment" d="M480 380 L480 140" />
    <path id="segment9" class="segment" d="M480 140 L100 100" />

    <!-- Circles -->
    <circle class="circle" id="Aba Zhu Songpan" cx="900" cy="100" r="15" fill="red" />
    <text x="900" y="90" text-anchor="middle">1. Aba Zhu Songpan</text>
    <circle class="circle" id="Lhasa" cx="820" cy="200" r="15" fill="red" />
    <text x="820" y="190" text-anchor="middle">2. Lhasa</text>
    <circle class="circle" id="Zhangmu" cx="760" cy="240" r="15" fill="red" />
    <text x="780" y="230" text-anchor="middle">3. Zhangmu</text>
    <circle class="circle" id="Kathmandu" cx="720" cy="280" r="15" fill="red" />
    <text x="720" y="270" text-anchor="middle">4. Kathmandu</text>
    <circle class="circle" id="Majnu Ka Tilla" cx="500" cy="200" r="15" fill="red" />
    <text x="500" y="190" text-anchor="middle">5. Majnu Ka Tilla</text>
    <circle class="circle" id="Dharamshala" cx="480" cy="140" r="15" fill="red" />
    <text x="480" y="130" text-anchor="middle">6. Dharamshala</text>
    <circle class="circle" id="Mussoorie" cx="520" cy="160" r="15" fill="red" />
    <text x="530" y="150" text-anchor="middle">7. Mussoorie</text>
    <circle class="circle" id="Bengaluru" cx="480" cy="380" r="15" fill="red" />
    <text x="480" y="370" text-anchor="middle">8. Bengaluru</text>
    <circle class="circle" id="Buffalo, NY" cx="100" cy="100" r="15" fill="red" />
    <text x="100" y="90" text-anchor="middle">9. Buffalo, NY</text>

    <!-- Walker -->
    <g id="walkerGroup" style="display: none;">
      <image id="walker" href="images/walker.png" width="40" height="40" />
      <animateMotion id="walkerMotion" begin="indefinite" dur="1.5s" fill="freeze" keySplines="0.25 0.1 0.25 1" keyTimes="0;1" calcMode="spline">
        <mpath xlink:href="#segment1" />
      </animateMotion>
    </g>
  </svg>

  <div id="storyPanel"></div>
  <button id="resetBtn" aria-label="Reset the game">ðŸ”„ Reset Game</button>
  </div>

  <script>
    const order = [
      "Aba Zhu Songpan", "Lhasa", "Zhangmu", "Kathmandu",
      "Majnu Ka Tilla", "Dharamshala", "Mussoorie", "Bengaluru",
      "Dharamshala", "Buffalo, NY"
    ];

    const storyText = {
      "Aba Zhu Songpan": `
        <p>My journey began in Aba, a remote region of Eastern Tibet, to a semi-nomadic family. Life was simple, but the shadows of political suppression under Chinese rule loomed large. Like many families fearing the erasure of Tibetan identity, my father made the heart-wrenching decision to send me to exile at age seven. I didnâ€™t understand it fully thenâ€”but it was the beginning of a journey that thousands of Tibetans have made in search of freedom and education.</p>
          <img class="story-image" src="images/aba-temple.jpg" alt="Aba Zhu Songpan">
      `,
      "Lhasa": `
        <p>We passed through Lhasaâ€”the spiritual and political capital of Tibet. Under Chinese occupation, it no longer felt like a free homeland. I remember being told not to speak too much, not to draw attention. Lhasa today remains a symbol of Tibetan resistance and longing. For the diaspora, it's both a beacon of cultural pride and a reminder of what weâ€™ve lost.</p>
        <img src="images/lhasa-tibet.jpg" alt="Lhasa" class="story-image">
      `,
      "Zhangmu": `
        <p>At Dram (Zhangmu), we reached the Tibetan-Nepalese border. It was here, hidden in the night, that I and many others escaped. Every step was filled with fear of being captured. Some never made it. Zhangmu stands for the desperation and courage that define the Tibetan exile journey. For students today, this is where our people risked everything for freedom.</p>
        <img src="images/Dram.jpg" alt="Zhangmu" class="story-image">
      `,
      "Kathmandu": `
        <p>We arrived in Kathmandu exhausted and frightened. But Nepal offered safetyâ€”for a moment. At the Tibetan Reception Centre, we waited with uncertainty, hoping for the chance to continue to India. Thousands of Tibetan children, like me, have passed through Kathmandu, making it a key gateway of exile. It was the first glimpse of a freer life.</p>
        <img src="images/nepal.jpg" alt="Kathmandu" class="story-image">
      `,
      "Majnu Ka Tilla": `
        <p>In Delhi, we were processed at the Tibetan Reception Centre in Majnu Ka Tilla. This Tibetan settlement is more than a neighborhoodâ€”it's a cultural stronghold. Here, the Indian government and the exile administration coordinated to shelter and educate refugees. It was my first sense of a community in exileâ€”one that embraces, supports, and rebuilds.</p>
        <img src="images/majnukatilla.jpg" alt="Majnu Ka Tilla" class="story-image">
      `,
      "Dharamshala-1": `
        <p>Dharamshalaâ€”home of the Tibetan Government-in-Exile and His Holiness the Dalai Lamaâ€”welcomed me. As a child, I didn't grasp the full weight of this place. But it gave me direction. Dharamshala became the heart of Tibetan freedom efforts and the base for nurturing thousands of children like me. Itâ€™s a place where exile became mission.</p>
        <img src="images/mcleod.jpg" alt="Dharamshala" class="story-image">
      `,
      "Mussoorie": `
        <p>I was raised and educated in Tibetan Homes School, Mussoorieâ€”one of the first schools founded in exile. Here, I grew up learning modern education alongside our language, history, and values. Living in group homes, we called our caretakers "Ama" and "Aba." This school created not just educated children, but future custodians of Tibetan identity.</p>
        <img src="images/ths.jpg" alt="Mussoorie" class="story-image">
      `,
      "Bengaluru": `
        <p>For my college studies, I moved to Bengaluru. It was the first time I lived among mostly non-Tibetans. I studied Computer Science and Engineering and learned how to express our stories digitally. It was in Bengaluru that I created <i>The Tibetan Journal</i>, to bring Tibetan voices to the world. Education became a tool for advocacy and innovation.</p>
        <img src="images/bengaluru.jpg" alt="Bengaluru" class="story-image">
      `,
      "Dharamshala-2": `
        <p>I returned to Dharamshalaâ€”this time not as a child seeking refuge, but as a contributor to a movement grounded in justice and cultural survival. As part of the Tibetan Government-in-Exile, I led the development of the Central Tibetan Database, a crucial system to strengthen the infrastructure of our diaspora. Since 1959, this government has served not merely as an administrative body, but as the political and spiritual heartbeat of our community in exile. Through its coordinated efforts, Tibetan settlements across India and Nepal were establishedâ€”complete with schools, health centers, and monasteriesâ€”to ensure that our language, culture, and national identity could be sustained despite displacement. These institutions are not just support systemsâ€”they are acts of resistance against the erasure of our identity under Chinese occupation. Every Tibetan, regardless of where they live, has a role in sustaining this vision. Contributing to the Tibetan Government-in-Exile is not just service; it is a responsibility to our collective future and our rightful struggle for justice.</p>
        <img src="images/cta.jpg" alt="Dharamshala - Return" class="story-image">
      `,
      "Buffalo, NY": `
        <p>My journey brought me to Buffalo, New York, for my Masterâ€™s and PhD. Now, I research computer science education for displaced communitiesâ€”especially Tibetan youth. This final stop represents not just physical migration, but the transformation of pain into purpose. In teaching and coding, I honor our history and shape a new future.</p>
        <img src="images/buffalo.jpg" alt="Buffalo, NY" class="story-image"">
      `
    };


    let currentStep = 0;
    let typewriterActive = false;
    let typingInterval = null;

    const messageEl = document.getElementById("message");
    const walker = document.getElementById("walker");
    const walkerGroup = document.getElementById("walkerGroup");
    const motion = document.getElementById("walkerMotion");
    const storyPanel = document.getElementById("storyPanel");

    function typeHTML(element, html, speed = 5) {
      if (typingInterval) clearInterval(typingInterval);
      element.innerHTML = "";
      let i = 0;
      typingInterval = setInterval(() => {
        element.innerHTML = html.slice(0, i);
        i++;
        if (i > html.length) {
          clearInterval(typingInterval);
          typingInterval = null;
          element.innerHTML = html; // Final correction
        }
      }, speed);
    }

    function resetGame() {
      currentStep = 0;
      typewriterActive = false;
      messageEl.textContent = "Start your journey...";
      walkerGroup.style.display = "none";
      storyPanel.style.display = "none";
      document.querySelectorAll(".circle").forEach(c => {
        c.setAttribute("fill", "red");
        c.classList.remove("active");
      });
      document.querySelectorAll(".segment").forEach(s => s.style.strokeDashoffset = "1000");
      document.getElementById(order[0]).classList.add("active");
    }

    document.getElementById("resetBtn").addEventListener("click", resetGame);

    // Setup click handlers
    order.forEach((location, index) => {
      const circle = document.getElementById(location);
      if (index === 0) circle.classList.add("active");

      circle.addEventListener("click", () => {
        if (location === order[currentStep]) {
          circle.setAttribute("fill", "green");
          circle.classList.remove("active");

          if (currentStep > 0) {
            const segment = document.getElementById(`segment${currentStep}`);
            segment.style.strokeDashoffset = "0";
            motion.innerHTML = `<mpath xlink:href="#segment${currentStep}" />`;
            motion.beginElement();
          }

          storyPanel.style.display = "block";
          let storyKey = location;
          if (location === "Dharamshala") {
            storyKey = (currentStep === 5) ? "Dharamshala-1" : "Dharamshala-2";
          }
          typeHTML(storyPanel, storyText[storyKey] || "");
          currentStep++;
          if (currentStep < order.length) {
            document.getElementById(order[currentStep]).classList.add("active");
            messageEl.textContent = `Good job! Next: ${order[currentStep]}`;
          } else {
            messageEl.textContent = "ðŸŽ‰ You've completed the journey!";
          }
        } else {
          messageEl.textContent = "Oops! That's not the next stop. Try again.";
        }
      });
    });
  </script>
</body>
</html>
